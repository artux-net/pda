name: Preview Build

on:
  workflow_dispatch:

jobs:
  build:
    name: Internal build
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{secrets.token}}
          submodules: recursive

      - uses: ./.github/assembly
        id: assembly

      - name: Send message to Artux channel
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            Preview сборка ${{github.run_number}}, версия ${{ steps.date.outputs.date }}-preview
            
            Ссылка для скачивания активна три месяца: 
            ${{steps.assembly.outputs.internalSharingDownloadUrls}}
            
            Изменения:
            ${{ github.event.head_commit.message }}
